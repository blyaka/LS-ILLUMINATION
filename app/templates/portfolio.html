{% extends '_base.html' %}
{% load static %}

{% load categories_tags %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/pages/portfolio.css' %}" />
{% endblock %}

{% block content %}

<div class="page-container">

    <div class="page-title">
        <h1>Портфолио</h1>
        <p class="about-meta">Санкт-Петербург • {{ today|date:"j E Y" }}</p>
    </div>

    <div class="category-name">
        <h1>{{ category.name }}</h1>
    </div>

    {% next_category categories category as next_cat %}
    {% if next_cat %}
    <div class="next-btn-container">
        <a href="{% url 'portfolio' slug=next_cat.slug %}" class="next-btn">
            <p>Следующая категория ></p>
        </a>
    </div>
    {% endif %}

    <div class="portfolio-grid">
        {% for case in cases %}
        <a class="card" href="#">
            <div class="card_photo">
                <img src="{{case.photo.url}}" alt="{{case.name}}" />
            </div>
        </a>
        {% endfor %}


    </div>

</div>

<!-- Модалка для просмотра изображения -->
<div class="image-modal" id="imageModal" hidden>
    <div class="image-modal__overlay" id="modalOverlay"></div>
    <button class="image-modal__close" id="modalClose">×</button>
    <div class="image-modal__content">
        <div class="image-modal__nav">
            <button class="image-modal__prev" id="modalPrev">
                <svg width="33" height="58" fill="none">
                    <use xlink:href="{% static 'images/icons.svg' %}#icon-arrow"></use>
                </svg>
            </button>
            <img id="modalImg" src="" alt="Large image">
            <button class="image-modal__next" id="modalNext">
                <svg width="33" height="58" fill="none">
                    <use xlink:href="{% static 'images/icons.svg' %}#icon-arrow"></use>
                </svg>
            </button>
        </div>
    </div>
</div>



<script>
    (() => {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImg');
        const modalClose = document.getElementById('modalClose');
        const modalPrev = document.getElementById('modalPrev');
        const modalNext = document.getElementById('modalNext');
        const modalOverlay = document.getElementById('modalOverlay');

        const images = [...document.querySelectorAll('.card_photo img')];  
        let currentIndex = 0;

        function openModal(index) {
            currentIndex = index;
            modalImg.src = images[currentIndex].src;
            modal.hidden = false; 
            setTimeout(() => modal.style.opacity = 1, 10); 
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            modal.style.opacity = 0; 
            setTimeout(() => modal.hidden = true, 300);
            document.body.style.overflow = ''; 
        }

        function showNextImage() {
            currentIndex = (currentIndex + 1) % images.length;
            modalImg.src = images[currentIndex].src;
        }

        function showPrevImage() {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            modalImg.src = images[currentIndex].src;
        }

        images.forEach((img, index) => {
            img.addEventListener('click', () => openModal(index));
        });

        modalClose.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', closeModal);
        modalNext.addEventListener('click', showNextImage);
        modalPrev.addEventListener('click', showPrevImage);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    })();
</script>






{% endblock %}